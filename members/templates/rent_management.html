{% extends 'base.html' %}

{% block content %}
<div class="section-container">
    <div class="section-header">
        <h2>Rent Management for {{ hostel.name }}</h2>
        <a href="{% url 'list_hostels_user' %}" class="btn btn-outline">Back to Hostels</a>
    </div>
    
    <div class="form-section">
        <h3>Add Rent Payment</h3>
        <form method="POST" action="{% url 'create_rent' hostel.id %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="student">Student</label>
                <select name="student" id="student" required>
                    {% for student in students %}
                        <option value="{{ student.id }}">{{ student.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="number" step="0.01" name="amount" id="amount" required>
            </div>
            <div class="form-group">
                <label for="due_date">Due Date</label>
                <input type="date" name="due_date" id="due_date" required>
            </div>
            <div class="form-group">
                <label for="is_paid">Payment Status</label>
                <select name="is_paid" id="is_paid">
                    <option value="True">Paid</option>
                    <option value="False">Unpaid</option>
                </select>
            </div>
            <div class="form-group" id="payment_date_group">
                <label for="payment_date">Payment Date</label>
                <input type="date" name="payment_date" id="payment_date">
            </div>
            <div class="form-group">
                <button type="submit" class="btn">Add Payment</button>
            </div>
        </form>
    </div>

    <div class="table-section">
        <h3>Rent Payment History</h3>
        {% if rent_payments %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Amount</th>
                    <th>Due Date</th>
                    <th>Paid</th>
                    <th>Payment Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for rent in rent_payments %}
                <tr>
                    <td>{{ rent.student.name }}</td>
                    <td>{{ rent.amount }}</td>
                    <td>{{ rent.due_date|date:"Y-m-d" }}</td>
                    <td>{{ rent.is_paid|yesno:"Yes,No" }}</td>
                    <td>{{ rent.payment_date|date:"Y-m-d"|default:"-" }}</td>
                    <td>
                        <a href="{% url 'edit_rent' rent.id %}" class="action-link">Edit</a>
                        <a href="{% url 'delete_rent' rent.id %}" class="action-link delete">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <p>No rent payments recorded yet.</p>
            <small>Payments will appear here once added</small>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Show/hide payment date field based on payment status
    document.getElementById('is_paid').addEventListener('change', function() {
        var paymentDateGroup = document.getElementById('payment_date_group');
        if (this.value === 'True') {
            paymentDateGroup.style.display = 'block';
        } else {
            paymentDateGroup.style.display = 'none';
        }
    });
    
    // Trigger on page load
    document.getElementById('is_paid').dispatchEvent(new Event('change'));
</script>
{% endblock %}
